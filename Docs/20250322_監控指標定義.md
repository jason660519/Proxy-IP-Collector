# 系統監控指標定義文件

## 1. 監控範圍與目標

### 1.1 監控範圍
- **基礎設施層面**：服務器資源、網絡連通性、資料庫性能
- **應用服務層面**：API響應時間、並發處理能力、錯誤率
- **業務邏輯層面**：代理收集效率、驗證成功率、評分準確性
- **用戶體驗層面**：前端響應速度、頁面載入時間、功能可用性

### 1.2 監控目標
- **可用性**：確保系統服務7×24小時穩定運行，達到99.9%可用率
- **性能**：維持API響應時間在500ms以內，代理驗證吞吐量達到1000個/小時
- **可靠性**：代理驗證準確率達到95%以上，數據一致性達到99%
- **安全性**：防止未授權訪問，確保數據傳輸加密，及時發現安全威脅

## 2. 關鍵性能指標（KPI）定義

### 2.1 基礎設施指標

#### 2.1.1 服務器資源
| 指標名稱 | 指標說明 | 單位 | 正常閾值 | 警告閾值 | 嚴重閾值 | 採集頻率 |
|---------|---------|------|---------|---------|---------|----------|
| CPU使用率 | 服務器CPU使用百分比 | % | <60% | 60-80% | >80% | 每30秒 |
| 內存使用率 | 服務器內存使用百分比 | % | <70% | 70-85% | >85% | 每30秒 |
| 磁盤使用率 | 磁盤空間使用百分比 | % | <80% | 80-90% | >90% | 每5分鐘 |
| 磁盤I/O | 磁盤讀寫速率 | MB/s | <100 | 100-200 | >200 | 每1分鐘 |
| 網絡帶寬 | 網絡上下行帶寬使用率 | % | <70% | 70-85% | >85% | 每1分鐘 |

#### 2.1.2 資料庫性能
| 指標名稱 | 指標說明 | 單位 | 正常閾值 | 警告閾值 | 嚴重閾值 | 採集頻率 |
|---------|---------|------|---------|---------|---------|----------|
| 連接數 | 當前資料庫連接數量 | count | <80%最大連接數 | 80-90% | >90% | 每30秒 |
| 查詢響應時間 | SQL查詢平均響應時間 | ms | <100ms | 100-500ms | >500ms | 每1分鐘 |
| 慢查詢數量 | 超過1秒的查詢數量 | count/分鐘 | <5 | 5-10 | >10 | 每1分鐘 |
| 鎖等待時間 | 事務鎖等待平均時間 | ms | <50ms | 50-200ms | >200ms | 每5分鐘 |

### 2.2 應用服務指標

#### 2.2.1 API性能指標
| 指標名稱 | 指標說明 | 單位 | 正常閾值 | 警告閾值 | 嚴重閾值 | 採集頻率 |
|---------|---------|------|---------|---------|---------|----------|
| API響應時間 | API平均響應時間 | ms | <200ms | 200-500ms | >500ms | 每1分鐘 |
| API成功率 | API請求成功百分比 | % | >99% | 95-99% | <95% | 每1分鐘 |
| API錯誤率 | API請求錯誤百分比 | % | <1% | 1-5% | >5% | 每1分鐘 |
| 並發請求數 | 當前並發請求數量 | count | <80%最大並發數 | 80-90% | >90% | 每30秒 |
| 請求吞吐量 | 每分鐘處理請求數 | req/min | >目標值90% | 70-90% | <70% | 每1分鐘 |

#### 2.2.2 代理服務指標
| 指標名稱 | 指標說明 | 單位 | 正常閾值 | 警告閾值 | 嚴重閾值 | 採集頻率 |
|---------|---------|------|---------|---------|---------|----------|
| 代理收集速率 | 每小時新收集代理數 | proxy/h | >500 | 200-500 | <200 | 每5分鐘 |
| 代理驗證成功率 | 代理驗證成功百分比 | % | >95% | 85-95% | <85% | 每5分鐘 |
| 代理平均評分 | 有效代理平均質量評分 | score | >70 | 50-70 | <50 | 每5分鐘 |
| 代理池大小 | 當前可用代理總數 | count | >1000 | 500-1000 | <500 | 每1分鐘 |
| 代理失效率 | 每小時代理失效百分比 | % | <5% | 5-15% | >15% | 每1小時 |

### 2.3 業務邏輯指標

#### 2.3.1 爬蟲性能指標
| 指標名稱 | 指標說明 | 單位 | 正常閾值 | 警告閾值 | 嚴重閾值 | 採集頻率 |
|---------|---------|------|---------|---------|---------|----------|
| 爬蟲任務成功率 | 爬蟲任務成功完成百分比 | % | >98% | 90-98% | <90% | 每5分鐘 |
| 爬蟲任務執行時間 | 爬蟲任務平均執行時間 | min | <30 | 30-60 | >60 | 每5分鐘 |
| 數據收集量 | 每小時收集代理數據條數 | record/h | >1000 | 500-1000 | <500 | 每1小時 |
| 數據質量評分 | 收集數據的準確性評分 | score | >90 | 70-90 | <70 | 每1小時 |

#### 2.3.2 驗證系統指標
| 指標名稱 | 指標說明 | 單位 | 正常閾值 | 警告閾值 | 嚴重閾值 | 採集頻率 |
|---------|---------|------|---------|---------|---------|----------|
| 驗證任務佇列長度 | 等待驗證的代理數量 | count | <100 | 100-500 | >500 | 每1分鐘 |
| 驗證處理速率 | 每分鐘完成驗證數量 | proxy/min | >50 | 20-50 | <20 | 每1分鐘 |
| 驗證準確率 | 驗證結果準確性百分比 | % | >95% | 85-95% | <85% | 每1小時 |
| 驗證超時率 | 驗證超時百分比 | % | <2% | 2-5% | >5% | 每1小時 |

### 2.4 用戶體驗指標

#### 2.4.1 前端性能指標
| 指標名稱 | 指標說明 | 單位 | 正常閾值 | 警告閾值 | 嚴重閾值 | 採集頻率 |
|---------|---------|------|---------|---------|---------|----------|
| 頁面載入時間 | 前端頁面平均載入時間 | s | <2s | 2-5s | >5s | 每5分鐘 |
| API請求響應時間 | 前端API請求響應時間 | ms | <300ms | 300-1000ms | >1000ms | 每1分鐘 |
| 前端錯誤率 | 前端JavaScript錯誤率 | % | <1% | 1-3% | >3% | 每1小時 |
| 用戶操作成功率 | 用戶操作成功百分比 | % | >99% | 95-99% | <95% | 每1小時 |

#### 2.4.2 系統可用性指標
| 指標名稱 | 指標說明 | 單位 | 正常閾值 | 警告閾值 | 嚴重閾值 | 採集頻率 |
|---------|---------|------|---------|---------|---------|----------|
| 系統可用率 | 系統正常運行時間百分比 | % | >99.9% | 99-99.9% | <99% | 每1小時 |
| 服務中斷次數 | 服務中斷事件次數 | count/天 | <1 | 1-3 | >3 | 每1天 |
| 平均故障恢復時間 | 從故障到恢復平均時間 | min | <15min | 15-60min | >60min | 每次故障 |
| 維護窗口時間 | 計劃維護時間 | h/週 | <4h | 4-8h | >8h | 每週 |

## 3. 監控實施方案

### 3.1 監控架構
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   指標採集層     │───▶│   數據處理層     │───▶│   展示告警層     │
│                 │    │                 │    │                 │
│ • Prometheus    │    │ • Grafana       │    │ • 監控Dashboard  │
│ • 自定義Exporter│    │ • 日誌聚合       │    │ • 告警通知       │
│ • 應用內置指標  │    │ • 數據分析       │    │ • 報告生成       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### 3.2 監控工具配置

#### 3.2.1 Prometheus配置
```yaml
global:
  scrape_interval: 15s
  evaluation_interval: 15s

scrape_configs:
  - job_name: 'proxy-collector'
    static_configs:
      - targets: ['localhost:8000']
    metrics_path: '/metrics'
    scrape_interval: 30s
    
  - job_name: 'node-exporter'
    static_configs:
      - targets: ['localhost:9100']
    scrape_interval: 30s
    
  - job_name: 'postgres-exporter'
    static_configs:
      - targets: ['localhost:9187']
    scrape_interval: 30s
```

#### 3.2.2 Grafana Dashboard配置
- **基礎設施監控面板**：CPU、內存、磁盤、網絡
- **應用性能監控面板**：API響應時間、錯誤率、吞吐量
- **業務指標監控面板**：代理收集、驗證成功率、評分分佈
- **告警概覽面板**：活躍告警、歷史告警、趨勢分析

### 3.3 告警規則設置

#### 3.3.1 緊急告警（Critical）
- 系統可用率低於99%
- API錯誤率超過5%
- 磁盤使用率超過90%
- 資料庫連接數超過90%最大連接數

#### 3.3.2 警告告警（Warning）
- CPU使用率超過80%
- 內存使用率超過85%
- API響應時間超過500ms
- 代理驗證成功率低於85%

#### 3.3.3 通知告警（Info）
- 系統維護窗口開始/結束
- 配置變更通知
- 批量任務完成通知

## 4. 指標追蹤與報告

### 4.1 日報內容
- 系統整體健康狀態
- 關鍵指標趨勢分析
- 異常事件統計
- 性能瓶頸識別

### 4.2 週報內容
- 一週指標趨勢對比
- 系統容量使用情況
- 業務指標達成情況
- 下週優化建議

### 4.3 月報內容
- 月度SLA達成情況
- 系統架構優化建議
- 資源擴容需求評估
- 下月重點工作計劃

## 5. 持續優化

### 5.1 指標優化
- 定期審查指標有效性
- 根據業務需求調整閾值
- 新增關鍵業務指標
- 移除過時或無用指標

### 5.2 監控系統優化
- 監控工具版本升級
- 監控覆蓋率提升
- 告警精準度改善
- 監控成本優化

### 5.3 流程優化
- 告警響應流程改進
- 故障處理效率提升
- 監控數據分析自動化
- 報告生成自動化

---

**文件版本**：v1.0  
**制定日期**：2025年3月22日  
**制定人**：系統架構師  
**審核狀態**：待審核  
**更新頻率**：每月更新