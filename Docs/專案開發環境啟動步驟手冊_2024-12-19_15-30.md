# 專案開發環境啟動步驟手冊

**更新日期**: 2025年9月22日 16:30  
**文件版本**: v2.0  
**維護人員**: DevOps Engineer

## 🚨 重要更新說明

本手冊已於 2025年9月22日 更新，包含以下重要修復：
- 修復了 API 端點的常見錯誤
- 添加了統一服務器啟動方式
- 更新了錯誤排查指南

## 環境狀態確認

### ✅ 當前環境檢查結果

1. **工作目錄**: `C:\Users\a0922\OneDrive\Desktop\My Proxy Collector`
2. **虛擬環境**: 已啟動 (.venv)
3. **Python版本**: 3.12.9
4. **依賴安裝狀態**: 
   - ✅ 後端依賴: 已安裝完成
   - ✅ 前端依賴: 已安裝完成

### 📋 依賴包清單

#### 後端主要依賴
- FastAPI 框架及相關組件
- 數據庫: asyncpg, alembic
- 異步處理: aiofiles, aiosignal, anyio
- 爬蟲: beautifulsoup4
- 任務隊列: celery, amqp, billiard
- 開發工具: black (代碼格式化)

#### 前端主要依賴
- React 18 + TypeScript
- UI組件: Ant Design 5.27.4
- 狀態管理: @reduxjs/toolkit, react-redux
- HTTP客戶端: axios
- 圖表: echarts, recharts
- 開發工具: vite, eslint, prettier

## 🚀 服務器啟動步驟

### 方式1: 啟動統一服務器（推薦）

```bash
# 進入後端目錄
cd backend

# 啟動統一服務器（同時提供前後端服務）
python unified_server.py --port 8001
```

**啟動成功指標**:
- ✅ 統一服務器模式: full
- ✅ 主機地址: 0.0.0.0:8001
- ✅ 前端靜態文件掛載完成
- ✅ API路由註冊完成

### 方式2: 分別啟動前後端服務器

#### 步驟1: 啟動後端服務器

```bash
# 進入後端目錄
cd backend

# 啟動後端服務器（使用Python直接運行）
python -m uvicorn react_server:app --host 0.0.0.0 --port 8000 --reload
```

**啟動成功指標**:
- ✅ Uvicorn running on http://0.0.0.0:8000
- ✅ Application startup complete
- ✅ API文檔可訪問: http://localhost:8000/docs

#### 步驟2: 啟動前端服務器

```bash
# 在新終端中，進入前端目錄
cd frontend-react

# 啟動前端開發服務器
npm run dev
```

**啟動成功指標**:
- ✅ VITE v4.5.14 ready
- ✅ Local: http://localhost:3001/ (端口可能因佔用而變化)
- ✅ 前端應用可正常訪問

## 🔗 訪問地址

### 開發環境訪問點

| 服務 | 地址 | 狀態 |
|------|------|------|
| 統一服務器 | http://localhost:8001 | ✅ 運行中 |
| 後端API (獨立) | http://localhost:8000 | ✅ 運行中 |
| 前端應用 (獨立) | http://localhost:3001 | ✅ 運行中 |
| API文檔 | http://localhost:8000/docs | ✅ 可訪問 |

### 端口說明
- 統一服務器端口: 8001 (推薦)
- 後端端口: 8000 (獨立模式)
- 前端端口: 3000 (默認)，如被佔用會自動切換到3001、3002等

## 🧪 API 端點測試

### 測試端點
統一服務器和獨立後端服務器都提供以下端點：

```bash
# 根端點
curl http://localhost:8001/

# 系統信息端點  
curl http://localhost:8001/info

# 健康檢查端點
curl http://localhost:8001/health
```

### 預期響應
- ✅ 根端點: 返回服務器基本信息
- ✅ 系統信息端點: 返回系統詳細信息（平台、Python版本等）
- ✅ 健康檢查端點: 返回服務健康狀態

## ⚠️ 常見問題處理

### 1. API 端點錯誤（已修復）

#### 問題1: 系統信息端點返回 500 錯誤
**原因**: `await` 用於同步函數  
**修復**: 移除 `service_launcher.py` 中 `get_system_info()` 的錯誤 `await`

#### 問題2: 根端點返回 500 錯誤  
**原因**: `await` 用於同步的 `get_status()` 方法  
**修復**: 移除 `main.py` 中對 `get_status()` 的錯誤 `await`

#### 問題3: setup_logging() 參數錯誤
**原因**: 向無參函數傳遞了參數  
**修復**: 在 `service_launcher.py` 中使用無參調用 `setup_logging()`

#### 問題4: 統一服務器缺少 /info 端點
**原因**: 統一服務器未實現系統信息端點  
**修復**: 在 `unified_server.py` 中添加 `/info` 路由

### 2. 端口被佔用
- **前端端口3000被佔用**: Vite會自動切換到下一個可用端口(3001, 3002等)
- **後端端口8000被佔用**: 需要停止佔用該端口的進程，或修改配置
- **統一服務器端口8001被佔用**: 使用 `--port` 參數指定其他端口

### 3. 依賴問題
- **後端依賴缺失**: 執行 `uv pip install -r requirements.txt`
- **前端依賴缺失**: 執行 `npm install`

### 4. 虛擬環境問題
- **虛擬環境未啟動**: 執行 `uv shell` 或 `source .venv/bin/activate`

### 5. Git 推送問題
- **分支不匹配**: 確保推送到正確的分支（master）
- **權限問題**: 檢查 GitHub 倉庫權限設置

## 📊 性能指標

### 當前環境性能
- 後端啟動時間: ~3-5秒
- 前端啟動時間: ~1-2秒
- 統一服務器啟動時間: ~5-8秒
- 熱重載: 已啟用
- 調試模式: 已啟用

## 📝 後續維護建議

1. **定期更新依賴**: 每月檢查並更新依賴包
2. **環境備份**: 定期備份虛擬環境和依賴配置
3. **端口管理**: 記錄各服務使用的端口，避免衝突
4. **日誌監控**: 定期檢查服務器日誌，及時發現問題
5. **API端點測試**: 定期測試所有API端點，確保正常運行

## 🔧 開發工具推薦

### PowerShell 命令技巧
```powershell
# 正確的命令分隔符（PowerShell）
cd "C:/path/to/dir"; python script.py

# 避免使用 && 分隔符（在PowerShell中無效）
```

### 測試命令
```python
# 快速測試API端點
import requests
response = requests.get('http://localhost:8001/')
print(response.status_code, response.json())
```

## 📞 聯繫方式

- **DevOps團隊**: 負責環境維護和問題處理
- **開發團隊**: 負責代碼相關問題
- **問題反饋**: 在項目Issues中提交

---

**備註**: 本手冊基於2025年9月22日的環境檢查和問題修復經驗更新，包含最新的API端點修復和統一服務器配置。