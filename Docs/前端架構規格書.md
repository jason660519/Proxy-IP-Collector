# Proxy IP Pool Collector - 前端架構規格書

## 1. 架構概述

### 1.1 設計理念
前端架構採用現代化的響應式設計，提供直觀的用戶界面來監控和管理代理IP池系統。架構核心目標是實現高可用性、優秀的用戶體驗和實時數據可視化。

### 1.2 技術選型
- **框架核心**: React 18 + TypeScript 5.0
- **狀態管理**: Redux Toolkit + RTK Query
- **UI組件庫**: Ant Design 5.0 + 自定義組件
- **圖表可視化**: Apache ECharts 5.0 + D3.js
- **實時通信**: WebSocket + Socket.io-client
- **構建工具**: Vite 4.0
- **測試框架**: Jest + React Testing Library + Cypress
- **代碼質量**: ESLint + Prettier + Husky

## 2. 項目結構與模組化設計

### 2.1 目錄結構
```
src/
├── components/          # 可復用組件
│   ├── common/         # 通用組件
│   ├── charts/         # 圖表組件
│   ├── tables/         # 表格組件
│   └── forms/          # 表單組件
├── pages/              # 頁面組件
│   ├── Dashboard/      # 儀表板
│   ├── Proxies/        # 代理管理
│   ├── Analytics/      # 數據分析
│   ├── Settings/       # 系統設置
│   └── Logs/           # 日誌查看
├── hooks/              # 自定義Hooks
├── services/           # API服務
├── store/              # Redux狀態管理
├── utils/              # 工具函數
├── types/              # TypeScript類型定義
├── styles/             # 全局樣式
└── config/             # 配置文件
```

### 2.2 核心組件架構
```typescript
// types/proxy.types.ts
export interface Proxy {
  id: string;
  ip: string;
  port: number;
  protocol: 'http' | 'https' | 'socks4' | 'socks5';
  country: string;
  anonymity: 'transparent' | 'anonymous' | 'elite';
  status: 'active' | 'inactive' | 'checking';
  responseTime: number;
  successRate: number;
  lastChecked: string;
  source: string;
  qualityScore: number;
}

export interface ProxyFilter {
  protocol?: string[];
  country?: string[];
  anonymity?: string[];
  status?: string[];
  minQualityScore?: number;
  searchText?: string;
}

// components/ProxyCard/ProxyCard.tsx
import React from 'react';
import { Card, Tag, Progress, Button, Space } from 'antd';
import { Proxy } from '@/types/proxy.types';
import { CountryFlag } from '@/components/common/CountryFlag';
import { StatusIndicator } from '@/components/common/StatusIndicator';

interface ProxyCardProps {
  proxy: Proxy;
  onCheck: (proxyId: string) => void;
  onDelete: (proxyId: string) => void;
  onEdit: (proxy: Proxy) => void;
}

export const ProxyCard: React.FC<ProxyCardProps> = ({
  proxy,
  onCheck,
  onDelete,
  onEdit
}) => {
  const getProtocolColor = (protocol: string) => {
    const colors = {
      'http': 'blue',
      'https': 'green',
      'socks4': 'orange',
      'socks5': 'red'
    };
    return colors[protocol] || 'default';
  };

  const getAnonymityColor = (anonymity: string) => {
    const colors = {
      'elite': 'gold',
      'anonymous': 'processing',
      'transparent': 'default'
    };
    return colors[anonymity] || 'default';
  };

  return (
    <Card
      title={
        <Space>
          <StatusIndicator status={proxy.status} />
          <span>{proxy.ip}:{proxy.port}</span>
        </Space>
      }
      extra={
        <Space>
          <Button size="small" onClick={() => onCheck(proxy.id)}>檢查</Button>
          <Button size="small" onClick={() => onEdit(proxy)}>編輯</Button>
          <Button size="small" danger onClick={() => onDelete(proxy.id)}>刪除</Button>
        </Space>
      }
    >
      <div className="proxy-card-content">
        <div className="proxy-info">
          <Space direction="vertical" style={{ width: '100%' }}>
            <div>
              <span>協議: </span>
              <Tag color={getProtocolColor(proxy.protocol)}>
                {proxy.protocol.toUpperCase()}
              </Tag>
            </div>
            <div>
              <span>國家: </span>
              <Space>
                <CountryFlag country={proxy.country} />
                <span>{proxy.country}</span>
              </Space>
            </div>
            <div>
              <span>匿名等級: </span>
              <Tag color={getAnonymityColor(proxy.anonymity)}>
                {proxy.anonymity}
              </Tag>
            </div>
          </Space>
        </div>
        
        <div className="proxy-metrics">
          <div className="metric-item">
            <span>響應時間: </span>
            <span className={proxy.responseTime < 1000 ? 'text-green' : 'text-red'}>
              {proxy.responseTime}ms
            </span>
          </div>
          <div className="metric-item">
            <span>成功率: </span>
            <Progress 
              percent={proxy.successRate * 100} 
              size="small"
              strokeColor={proxy.successRate > 0.8 ? '#52c41a' : '#ff4d4f'}
            />
          </div>
          <div className="metric-item">
            <span>質量評分: </span>
            <Progress 
              percent={proxy.qualityScore * 100} 
              size="small"
              status={proxy.qualityScore > 0.7 ? 'success' : 'exception'}
            />
          </div>
        </div>
        
        <div className="proxy-meta">
          <Space>
            <span>來源: {proxy.source}</span>
            <span>最後檢查: {new Date(proxy.lastChecked).toLocaleString()}</span>
          </Space>
        </div>
      </div>
    </Card>
  );
};
```

## 3. 狀態管理架構

### 3.1 Redux Store 設計
```typescript
// store/index.ts
import { configureStore } from '@reduxjs/toolkit';
import proxySlice from './slices/proxySlice';
import filterSlice from './slices/filterSlice';
import dashboardSlice from './slices/dashboardSlice';
import { proxyApi } from './services/proxyApi';

export const store = configureStore({
  reducer: {
    proxy: proxySlice,
    filter: filterSlice,
    dashboard: dashboardSlice,
    [proxyApi.reducerPath]: proxyApi.reducer,
  },
  middleware: (getDefaultMiddleware) =>
    getDefaultMiddleware({
      serializableCheck: {
        ignoredActions: ['persist/PERSIST'],
      },
    }).concat(proxyApi.middleware),
});

export type RootState = ReturnType<typeof store.getState>;
export type AppDispatch = typeof store.dispatch;

// store/slices/proxySlice.ts
import { createSlice, PayloadAction } from '@reduxjs/toolkit';
import { Proxy } from '@/types/proxy.types';

interface ProxyState {
  proxies: Proxy[];
  selectedProxies: string[];
  loading: boolean;
  error: string | null;
  pagination: {
    current: number;
    pageSize: number;
    total: number;
  };
}

const initialState: ProxyState = {
  proxies: [],
  selectedProxies: [],
  loading: false,
  error: null,
  pagination: {
    current: 1,
    pageSize: 20,
    total: 0,
  },
};

const proxySlice = createSlice({
  name: 'proxy',
  initialState,
  reducers: {
    setProxies: (state, action: PayloadAction<Proxy[]>) => {
      state.proxies = action.payload;
    },
    setSelectedProxies: (state, action: PayloadAction<string[]>) => {
      state.selectedProxies = action.payload;
    },
    setLoading: (state, action: PayloadAction<boolean>) => {
      state.loading = action.payload;
    },
    setError: (state, action: PayloadAction<string | null>) => {
      state.error = action.payload;
    },
    setPagination: (state, action: PayloadAction<Partial<typeof initialState.pagination>>) => {
      state.pagination = { ...state.pagination, ...action.payload };
    },
    updateProxy: (state, action: PayloadAction<Proxy>) => {
      const index = state.proxies.findIndex(p => p.id === action.payload.id);
      if (index !== -1) {
        state.proxies[index] = action.payload;
      }
    },
    deleteProxy: (state, action: PayloadAction<string>) => {
      state.proxies = state.proxies.filter(p => p.id !== action.payload);
      state.selectedProxies = state.selectedProxies.filter(id => id !== action.payload);
    },
  },
});

export const {
  setProxies,
  setSelectedProxies,
  setLoading,
  setError,
  setPagination,
  updateProxy,
  deleteProxy,
} = proxySlice.actions;

export default proxySlice.reducer;
```

### 3.2 RTK Query API 服務
```typescript
// store/services/proxyApi.ts
import { createApi, fetchBaseQuery } from '@reduxjs/toolkit/query/react';
import { Proxy, ProxyFilter } from '@/types/proxy.types';

export const proxyApi = createApi({
  reducerPath: 'proxyApi',
  baseQuery: fetchBaseQuery({
    baseUrl: '/api/v1/',
    prepareHeaders: (headers, { getState }) => {
      const token = (getState() as any).auth.token;
      if (token) {
        headers.set('authorization', `Bearer ${token}`);
      }
      return headers;
    },
  }),
  tagTypes: ['Proxy', 'ProxyStats'],
  endpoints: (builder) => ({
    getProxies: builder.query<{
      proxies: Proxy[];
      total: number;
      page: number;
      pageSize: number;
    }, {
      page?: number;
      pageSize?: number;
      filter?: ProxyFilter;
    }>({
      query: ({ page = 1, pageSize = 20, filter = {} }) => ({
        url: 'proxies',
        params: {
          page,
          pageSize,
          ...filter,
        },
      }),
      providesTags: (result) =>
        result
          ? [
              ...result.proxies.map(({ id }) => ({ type: 'Proxy' as const, id })),
              { type: 'Proxy', id: 'LIST' },
            ]
          : [{ type: 'Proxy', id: 'LIST' }],
    }),
    
    getProxyById: builder.query<Proxy, string>({
      query: (id) => `proxies/${id}`,
      providesTags: (result, error, id) => [{ type: 'Proxy', id }],
    }),
    
    checkProxy: builder.mutation<{
      success: boolean;
      responseTime: number;
      status: string;
    }, string>({
      query: (id) => ({
        url: `proxies/${id}/check`,
        method: 'POST',
      }),
      invalidatesTags: (result, error, id) => [{ type: 'Proxy', id }],
    }),
    
    bulkCheckProxies: builder.mutation<{
      results: Array<{
        proxyId: string;
        success: boolean;
        responseTime: number;
        status: string;
      }>;
    }, string[]>({
      query: (proxyIds) => ({
        url: 'proxies/bulk-check',
        method: 'POST',
        body: { proxyIds },
      }),
      invalidatesTags: (result, error, ids) =>
        ids.map((id) => ({ type: 'Proxy', id })),
    }),
    
    deleteProxy: builder.mutation<void, string>({
      query: (id) => ({
        url: `proxies/${id}`,
        method: 'DELETE',
      }),
      invalidatesTags: (result, error, id) => [{ type: 'Proxy', id }],
    }),
    
    bulkDeleteProxies: builder.mutation<void, string[]>({
      query: (proxyIds) => ({
        url: 'proxies/bulk-delete',
        method: 'POST',
        body: { proxyIds },
      }),
      invalidatesTags: (result, error, ids) =>
        ids.map((id) => ({ type: 'Proxy', id })),
    }),
    
    getProxyStats: builder.query<{
      totalProxies: number;
      activeProxies: number;
      byProtocol: Record<string, number>;
      byCountry: Record<string, number>;
      byAnonymity: Record<string, number>;
      averageResponseTime: number;
      averageSuccessRate: number;
    }, void>({
      query: () => 'proxies/stats',
      providesTags: ['ProxyStats'],
    }),
    
    getProxyHistory: builder.query<{
      data: Array<{
        timestamp: string;
        totalProxies: number;
        activeProxies: number;
        successRate: number;
      }>;
    }, {
      timeRange: '1h' | '24h' | '7d' | '30d';
    }>({
      query: ({ timeRange }) => ({
        url: 'proxies/history',
        params: { timeRange },
      }),
    }),
  }),
});

export const {
  useGetProxiesQuery,
  useGetProxyByIdQuery,
  useCheckProxyMutation,
  useBulkCheckProxiesMutation,
  useDeleteProxyMutation,
  useBulkDeleteProxiesMutation,
  useGetProxyStatsQuery,
  useGetProxyHistoryQuery,
} = proxyApi;
```

## 4. 頁面架構設計

### 4.1 儀表板頁面
```typescript
// pages/Dashboard/Dashboard.tsx
import React, { useEffect } from 'react';
import { Row, Col, Card, Statistic, Space } from 'antd';
import { ArrowUpOutlined, ArrowDownOutlined } from '@ant-design/icons';
import { useGetProxyStatsQuery, useGetProxyHistoryQuery } from '@/store/services/proxyApi';
import { ProxyStatsChart } from '@/components/charts/ProxyStatsChart';
import { ProtocolDistributionChart } from '@/components/charts/ProtocolDistributionChart';
import { CountryDistributionChart } from '@/components/charts/CountryDistributionChart';
import { RecentActivity } from '@/components/common/RecentActivity';

const Dashboard: React.FC = () => {
  const { data: stats, isLoading: statsLoading } = useGetProxyStatsQuery();
  const { data: history, isLoading: historyLoading } = useGetProxyHistoryQuery({ timeRange: '24h' });

  if (statsLoading || historyLoading) {
    return <div>加載中...</div>;
  }

  const trendData = history?.data || [];
  const latestData = trendData[trendData.length - 1] || { totalProxies: 0, activeProxies: 0 };
  const previousData = trendData[trendData.length - 2] || { totalProxies: 0, activeProxies: 0 };

  const totalTrend = latestData.totalProxies - previousData.totalProxies;
  const activeTrend = latestData.activeProxies - previousData.activeProxies;

  return (
    <div className="dashboard">
      <Row gutter={[16, 16]}>
        <Col xs={24} sm={12} lg={6}>
          <Card>
            <Statistic
              title="總代理數量"
              value={stats?.totalProxies || 0}
              valueStyle={{ color: '#3f8600' }}
              prefix={totalTrend >= 0 ? <ArrowUpOutlined /> : <ArrowDownOutlined />}
              suffix={`${Math.abs(totalTrend)}`}
            />
          </Card>
        </Col>
        <Col xs={24} sm={12} lg={6}>
          <Card>
            <Statistic
              title="活躍代理"
              value={stats?.activeProxies || 0}
              valueStyle={{ color: '#cf1322' }}
              prefix={activeTrend >= 0 ? <ArrowUpOutlined /> : <ArrowDownOutlined />}
              suffix={`${Math.abs(activeTrend)}`}
            />
          </Card>
        </Col>
        <Col xs={24} sm={12} lg={6}>
          <Card>
            <Statistic
              title="平均響應時間"
              value={stats?.averageResponseTime || 0}
              precision={0}
              valueStyle={{ color: '#1890ff' }}
              suffix="ms"
            />
          </Card>
        </Col>
        <Col xs={24} sm={12} lg={6}>
          <Card>
            <Statistic
              title="平均成功率"
              value={(stats?.averageSuccessRate || 0) * 100}
              precision={1}
              valueStyle={{ color: '#722ed1' }}
              suffix="%"
            />
          </Card>
        </Col>
      </Row>

      <Row gutter={[16, 16]} style={{ marginTop: 16 }}>
        <Col xs={24} lg={12}>
          <Card title="代理數量趨勢">
            <ProxyStatsChart data={trendData} />
          </Card>
        </Col>
        <Col xs={24} lg={12}>
          <Card title="協議分佈">
            <ProtocolDistributionChart data={stats?.byProtocol || {}} />
          </Card>
        </Col>
      </Row>

      <Row gutter={[16, 16]} style={{ marginTop: 16 }}>
        <Col xs={24} lg={12}>
          <Card title="國家分佈">
            <CountryDistributionChart data={stats?.byCountry || {}} />
          </Card>
        </Col>
        <Col xs={24} lg={12}>
          <Card title="最近活動">
            <RecentActivity />
          </Card>
        </Col>
      </Row>
    </div>
  );
};

export default Dashboard;
```

### 4.2 代理管理頁面
```typescript
// pages/Proxies/ProxyList.tsx
import React, { useState, useEffect } from 'react';
import { Table, Button, Space, Input, Select, Tag, Modal, message } from 'antd';
import { SearchOutlined, ReloadOutlined, DeleteOutlined, CheckOutlined } from '@ant-design/icons';
import type { ColumnsType } from 'antd/es/table';
import { ProxyCard } from '@/components/ProxyCard/ProxyCard';
import { ProxyFilter } from '@/components/ProxyFilter/ProxyFilter';
import { useGetProxiesQuery, useCheckProxyMutation, useBulkCheckProxiesMutation, useDeleteProxyMutation, useBulkDeleteProxiesMutation } from '@/store/services/proxyApi';
import { Proxy, ProxyFilter as FilterType } from '@/types/proxy.types';

const { Search } = Input;
const { Option } = Select;

const ProxyList: React.FC = () => {
  const [page, setPage] = useState(1);
  const [pageSize, setPageSize] = useState(20);
  const [filter, setFilter] = useState<FilterType>({});
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [viewMode, setViewMode] = useState<'table' | 'card'>('table');

  const { data, isLoading, refetch } = useGetProxiesQuery({
    page,
    pageSize,
    filter,
  });

  const [checkProxy] = useCheckProxyMutation();
  const [bulkCheckProxies] = useBulkCheckProxiesMutation();
  const [deleteProxy] = useDeleteProxyMutation();
  const [bulkDeleteProxies] = useBulkDeleteProxiesMutation();

  const handleCheckProxy = async (id: string) => {
    try {
      await checkProxy(id).unwrap();
      message.success('代理檢查完成');
    } catch (error) {
      message.error('代理檢查失敗');
    }
  };

  const handleBulkCheck = async () => {
    if (selectedRowKeys.length === 0) {
      message.warning('請選擇要檢查的代理');
      return;
    }

    try {
      await bulkCheckProxies(selectedRowKeys as string[]).unwrap();
      message.success(`已開始檢查 ${selectedRowKeys.length} 個代理`);
      setSelectedRowKeys([]);
    } catch (error) {
      message.error('批量檢查失敗');
    }
  };

  const handleDeleteProxy = async (id: string) => {
    Modal.confirm({
      title: '確認刪除',
      content: '確定要刪除此代理嗎？',
      onOk: async () => {
        try {
          await deleteProxy(id).unwrap();
          message.success('代理刪除成功');
        } catch (error) {
          message.error('代理刪除失敗');
        }
      },
    });
  };

  const handleBulkDelete = async () => {
    if (selectedRowKeys.length === 0) {
      message.warning('請選擇要刪除的代理');
      return;
    }

    Modal.confirm({
      title: '確認批量刪除',
      content: `確定要刪除選中的 ${selectedRowKeys.length} 個代理嗎？`,
      onOk: async () => {
        try {
          await bulkDeleteProxies(selectedRowKeys as string[]).unwrap();
          message.success(`已刪除 ${selectedRowKeys.length} 個代理`);
          setSelectedRowKeys([]);
        } catch (error) {
          message.error('批量刪除失敗');
        }
      },
    });
  };

  const columns: ColumnsType<Proxy> = [
    {
      title: 'IP地址',
      dataIndex: 'ip',
      key: 'ip',
      render: (text: string, record: Proxy) => (
        <Space>
          <Tag color={record.status === 'active' ? 'green' : 'red'}>
            {record.status === 'active' ? '在線' : '離線'}
          </Tag>
          <span>{text}:{record.port}</span>
        </Space>
      ),
    },
    {
      title: '協議',
      dataIndex: 'protocol',
      key: 'protocol',
      render: (protocol: string) => (
        <Tag color={
          protocol === 'http' ? 'blue' :
          protocol === 'https' ? 'green' :
          protocol === 'socks4' ? 'orange' : 'red'
        }>
          {protocol.toUpperCase()}
        </Tag>
      ),
    },
    {
      title: '國家',
      dataIndex: 'country',
      key: 'country',
    },
    {
      title: '匿名等級',
      dataIndex: 'anonymity',
      key: 'anonymity',
      render: (anonymity: string) => (
        <Tag color={
          anonymity === 'elite' ? 'gold' :
          anonymity === 'anonymous' ? 'processing' : 'default'
        }>
          {anonymity}
        </Tag>
      ),
    },
    {
      title: '響應時間',
      dataIndex: 'responseTime',
      key: 'responseTime',
      render: (time: number) => (
        <span className={time < 1000 ? 'text-green' : 'text-red'}>
          {time}ms
        </span>
      ),
    },
    {
      title: '成功率',
      dataIndex: 'successRate',
      key: 'successRate',
      render: (rate: number) => (
        <span className={rate > 0.8 ? 'text-green' : 'text-red'}>
          {(rate * 100).toFixed(1)}%
        </span>
      ),
    },
    {
      title: '質量評分',
      dataIndex: 'qualityScore',
      key: 'qualityScore',
      render: (score: number) => (
        <span className={score > 0.7 ? 'text-green' : 'text-red'}>
          {(score * 100).toFixed(0)}
        </span>
      ),
    },
    {
      title: '最後檢查',
      dataIndex: 'lastChecked',
      key: 'lastChecked',
      render: (date: string) => new Date(date).toLocaleString(),
    },
    {
      title: '操作',
      key: 'action',
      render: (_, record: Proxy) => (
        <Space size="small">
          <Button
            size="small"
            icon={<CheckOutlined />}
            onClick={() => handleCheckProxy(record.id)}
          >
            檢查
          </Button>
          <Button
            size="small"
            danger
            icon={<DeleteOutlined />}
            onClick={() => handleDeleteProxy(record.id)}
          >
            刪除
          </Button>
        </Space>
      ),
    },
  ];

  const rowSelection = {
    selectedRowKeys,
    onChange: (newSelectedRowKeys: React.Key[]) => {
      setSelectedRowKeys(newSelectedRowKeys);
    },
  };

  return (
    <div className="proxy-list">
      <div className="proxy-list-header">
        <Space style={{ marginBottom: 16 }}>
          <Search
            placeholder="搜索IP地址"
            allowClear
            enterButton={<SearchOutlined />}
            style={{ width: 300 }}
            onSearch={(value) => setFilter({ ...filter, searchText: value })}
          />
          <ProxyFilter
            value={filter}
            onChange={setFilter}
          />
          <Button
            type="primary"
            icon={<ReloadOutlined />}
            onClick={() => refetch()}
            loading={isLoading}
          >
            刷新
          </Button>
        </Space>

        <Space>
          <Select
            value={viewMode}
            onChange={setViewMode}
            style={{ width: 100 }}
          >
            <Option value="table">表格</Option>
            <Option value="card">卡片</Option>
          </Select>
          {selectedRowKeys.length > 0 && (
            <Space>
              <Button
                type="primary"
                icon={<CheckOutlined />}
                onClick={handleBulkCheck}
              >
                批量檢查
              </Button>
              <Button
                danger
                icon={<DeleteOutlined />}
                onClick={handleBulkDelete}
              >
                批量刪除
              </Button>
            </Space>
          )}
        </Space>
      </div>

      {viewMode === 'table' ? (
        <Table
          rowKey="id"
          rowSelection={rowSelection}
          columns={columns}
          dataSource={data?.proxies || []}
          loading={isLoading}
          pagination={{
            current: page,
            pageSize,
            total: data?.total || 0,
            onChange: (page, pageSize) => {
              setPage(page);
              setPageSize(pageSize);
            },
            showSizeChanger: true,
            showTotal: (total) => `總共 ${total} 條`,
          }}
        />
      ) : (
        <div className="proxy-cards">
          <Row gutter={[16, 16]}>
            {data?.proxies.map((proxy) => (
              <Col key={proxy.id} xs={24} sm={12} lg={8} xl={6}>
                <ProxyCard
                  proxy={proxy}
                  onCheck={handleCheckProxy}
                  onDelete={handleDeleteProxy}
                  onEdit={() => {}}
                />
              </Col>
            ))}
          </Row>
        </div>
      )}
    </div>
  );
};

export default ProxyList;
```

## 5. 實時通信架構

### 5.1 WebSocket 連接管理
```typescript
// services/websocket.ts
import { io, Socket } from 'socket.io-client';
import { EventEmitter } from 'events';

export class WebSocketService extends EventEmitter {
  private socket: Socket | null = null;
  private url: string;
  private reconnectAttempts = 0;
  private maxReconnectAttempts = 5;
  private reconnectDelay = 1000;

  constructor(url: string = 'ws://localhost:8080') {
    super();
    this.url = url;
  }

  connect(): void {
    this.socket = io(this.url, {
      transports: ['websocket'],
      reconnection: true,
      reconnectionAttempts: this.maxReconnectAttempts,
      reconnectionDelay: this.reconnectDelay,
    });

    this.socket.on('connect', () => {
      console.log('WebSocket connected');
      this.reconnectAttempts = 0;
      this.emit('connected');
    });

    this.socket.on('disconnect', (reason) => {
      console.log('WebSocket disconnected:', reason);
      this.emit('disconnected', reason);
    });

    this.socket.on('error', (error) => {
      console.error('WebSocket error:', error);
      this.emit('error', error);
    });

    // 代理相關事件
    this.socket.on('proxy:updated', (data) => {
      this.emit('proxyUpdated', data);
    });

    this.socket.on('proxy:deleted', (data) => {
      this.emit('proxyDeleted', data);
    });

    this.socket.on('proxy:batch-updated', (data) => {
      this.emit('proxyBatchUpdated', data);
    });

    // 系統狀態事件
    this.socket.on('system:status', (data) => {
      this.emit('systemStatus', data);
    });

    this.socket.on('system:alert', (data) => {
      this.emit('systemAlert', data);
    });

    // ETL進度事件
    this.socket.on('etl:progress', (data) => {
      this.emit('etlProgress', data);
    });

    this.socket.on('etl:completed', (data) => {
      this.emit('etlCompleted', data);
    });
  }

  disconnect(): void {
    if (this.socket) {
      this.socket.disconnect();
      this.socket = null;
    }
  }

  subscribe(channel: string): void {
    if (this.socket) {
      this.socket.emit('subscribe', channel);
    }
  }

  unsubscribe(channel: string): void {
    if (this.socket) {
      this.socket.emit('unsubscribe', channel);
    }
  }

  isConnected(): boolean {
    return this.socket?.connected || false;
  }
}

// hooks/useWebSocket.ts
import { useEffect, useRef, useState } from 'react';
import { WebSocketService } from '@/services/websocket';

export const useWebSocket = () => {
  const wsRef = useRef<WebSocketService | null>(null);
  const [isConnected, setIsConnected] = useState(false);

  useEffect(() => {
    const ws = new WebSocketService();
    wsRef.current = ws;

    ws.on('connected', () => setIsConnected(true));
    ws.on('disconnected', () => setIsConnected(false));

    ws.connect();

    return () => {
      ws.disconnect();
    };
  }, []);

  return {
    socket: wsRef.current,
    isConnected,
  };
};
```

## 6. 圖表可視化組件

### 6.1 代理統計圖表
```typescript
// components/charts/ProxyStatsChart.tsx
import React, { useEffect, useRef } from 'react';
import * as echarts from 'echarts';

interface ProxyStatsChartProps {
  data: Array<{
    timestamp: string;
    totalProxies: number;
    activeProxies: number;
    successRate: number;
  }>;
}

export const ProxyStatsChart: React.FC<ProxyStatsChartProps> = ({ data }) => {
  const chartRef = useRef<HTMLDivElement>(null);
  const chartInstance = useRef<echarts.ECharts | null>(null);

  useEffect(() => {
    if (!chartRef.current) return;

    if (!chartInstance.current) {
      chartInstance.current = echarts.init(chartRef.current);
    }

    const option: echarts.EChartsOption = {
      title: {
        text: '代理統計趨勢',
        left: 'center',
      },
      tooltip: {
        trigger: 'axis',
        axisPointer: {
          type: 'cross',
        },
      },
      legend: {
        data: ['總代理數', '活躍代理數', '成功率'],
        top: 30,
      },
      grid: {
        left: '3%',
        right: '4%',
        bottom: '3%',
        containLabel: true,
      },
      xAxis: {
        type: 'category',
        boundaryGap: false,
        data: data.map(item => new Date(item.timestamp).toLocaleTimeString()),
      },
      yAxis: [
        {
          type: 'value',
          name: '數量',
          position: 'left',
        },
        {
          type: 'value',
          name: '成功率',
          position: 'right',
          axisLabel: {
            formatter: '{value}%',
          },
        },
      ],
      series: [
        {
          name: '總代理數',
          type: 'line',
          data: data.map(item => item.totalProxies),
          smooth: true,
          itemStyle: {
            color: '#1890ff',
          },
        },
        {
          name: '活躍代理數',
          type: 'line',
          data: data.map(item => item.activeProxies),
          smooth: true,
          itemStyle: {
            color: '#52c41a',
          },
        },
        {
          name: '成功率',
          type: 'line',
          yAxisIndex: 1,
          data: data.map(item => (item.successRate * 100).toFixed(1)),
          smooth: true,
          itemStyle: {
            color: '#fa8c16',
          },
        },
      ],
    };

    chartInstance.current.setOption(option);

    const handleResize = () => {
      chartInstance.current?.resize();
    };

    window.addEventListener('resize', handleResize);

    return () => {
      window.removeEventListener('resize', handleResize);
      chartInstance.current?.dispose();
    };
  }, [data]);

  return <div ref={chartRef} style={{ width: '100%', height: '400px' }} />;
};

// components/charts/ProtocolDistributionChart.tsx
import React, { useEffect, useRef } from 'react';
import * as echarts from 'echarts';

interface ProtocolDistributionChartProps {
  data: Record<string, number>;
}

export const ProtocolDistributionChart: React.FC<ProtocolDistributionChartProps> = ({ data }) => {
  const chartRef = useRef<HTMLDivElement>(null);
  const chartInstance = useRef<echarts.ECharts | null>(null);

  useEffect(() => {
    if (!chartRef.current) return;

    if (!chartInstance.current) {
      chartInstance.current = echarts.init(chartRef.current);
    }

    const pieData = Object.entries(data).map(([protocol, count]) => ({
      name: protocol.toUpperCase(),
      value: count,
    }));

    const option: echarts.EChartsOption = {
      title: {
        text: '協議分佈',
        left: 'center',
      },
      tooltip: {
        trigger: 'item',
        formatter: '{a} <br/>{b}: {c} ({d}%)',
      },
      legend: {
        orient: 'vertical',
        left: 'left',
      },
      series: [
        {
          name: '協議',
          type: 'pie',
          radius: '50%',
          data: pieData,
          emphasis: {
            itemStyle: {
              shadowBlur: 10,
              shadowOffsetX: 0,
              shadowColor: 'rgba(0, 0, 0, 0.5)',
            },
          },
          itemStyle: {
            color: (params: any) => {
              const colors = ['#1890ff', '#52c41a', '#fa8c16', '#f5222d'];
              return colors[params.dataIndex % colors.length];
            },
          },
        },
      ],
    };

    chartInstance.current.setOption(option);

    const handleResize = () => {
      chartInstance.current?.resize();
    };

    window.addEventListener('resize', handleResize);

    return () => {
      window.removeEventListener('resize', handleResize);
    };
  }, [data]);

  return <div ref={chartRef} style={{ width: '100%', height: '400px' }} />;
};
```

## 7. 路由與導航架構

### 7.1 路由配置
```typescript
// router/index.tsx
import React from 'react';
import { BrowserRouter, Routes, Route, Navigate } from 'react-router-dom';
import { Layout } from 'antd';
import { AppLayout } from '@/components/Layout/AppLayout';
import Dashboard from '@/pages/Dashboard/Dashboard';
import ProxyList from '@/pages/Proxies/ProxyList';
import Analytics from '@/pages/Analytics/Analytics';
import Settings from '@/pages/Settings/Settings';
import Logs from '@/pages/Logs/Logs';
import { ProtectedRoute } from '@/components/Auth/ProtectedRoute';

const Router: React.FC = () => {
  return (
    <BrowserRouter>
      <Routes>
        <Route path="/login" element={<div>登錄頁面</div>} />
        <Route
          path="/"
          element={
            <ProtectedRoute>
              <AppLayout />
            </ProtectedRoute>
          }
        >
          <Route index element={<Navigate to="/dashboard" replace />} />
          <Route path="dashboard" element={<Dashboard />} />
          <Route path="proxies" element={<ProxyList />} />
          <Route path="analytics" element={<Analytics />} />
          <Route path="settings" element={<Settings />} />
          <Route path="logs" element={<Logs />} />
        </Route>
        <Route path="*" element={<div>404 - 頁面未找到</div>} />
      </Routes>
    </BrowserRouter>
  );
};

export default Router;

// components/Layout/AppLayout.tsx
import React, { useState } from 'react';
import { Layout, Menu, Avatar, Dropdown, Space } from 'antd';
import {
  DashboardOutlined,
  GlobalOutlined,
  BarChartOutlined,
  SettingOutlined,
  FileTextOutlined,
  UserOutlined,
  LogoutOutlined,
} from '@ant-design/icons';
import { Outlet, useNavigate, useLocation } from 'react-router-dom';

const { Header, Sider, Content } = Layout;

export const AppLayout: React.FC = () => {
  const [collapsed, setCollapsed] = useState(false);
  const navigate = useNavigate();
  const location = useLocation();

  const menuItems = [
    {
      key: '/dashboard',
      icon: <DashboardOutlined />,
      label: '儀表板',
    },
    {
      key: '/proxies',
      icon: <GlobalOutlined />,
      label: '代理管理',
    },
    {
      key: '/analytics',
      icon: <BarChartOutlined />,
      label: '數據分析',
    },
    {
      key: '/logs',
      icon: <FileTextOutlined />,
      label: '系統日誌',
    },
    {
      key: '/settings',
      icon: <SettingOutlined />,
      label: '系統設置',
    },
  ];

  const userMenuItems = [
    {
      key: 'profile',
      icon: <UserOutlined />,
      label: '個人資料',
    },
    {
      key: 'logout',
      icon: <LogoutOutlined />,
      label: '退出登錄',
      danger: true,
    },
  ];

  const handleMenuClick = ({ key }: { key: string }) => {
    if (key === 'logout') {
      // 處理退出登錄邏輯
      console.log('退出登錄');
    } else if (key === 'profile') {
      navigate('/profile');
    }
  };

  return (
    <Layout style={{ minHeight: '100vh' }}>
      <Sider
        collapsible
        collapsed={collapsed}
        onCollapse={setCollapsed}
        theme="dark"
      >
        <div className="logo" style={{ height: 64, display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white' }}>
          <h3>{collapsed ? 'PIP' : 'Proxy IP Pool'}</h3>
        </div>
        <Menu
          theme="dark"
          mode="inline"
          selectedKeys={[location.pathname]}
          items={menuItems}
          onClick={({ key }) => navigate(key)}
        />
      </Sider>
      <Layout>
        <Header style={{ padding: 0, background: '#fff', display: 'flex', justifyContent: 'space-between', alignItems: 'center', paddingRight: 24 }}>
          <div style={{ paddingLeft: 24 }}>
            <h2 style={{ margin: 0 }}>
              {menuItems.find(item => item.key === location.pathname)?.label || '頁面'}
            </h2>
          </div>
          <Dropdown
            menu={{ items: userMenuItems, onClick: handleMenuClick }}
            placement="bottomRight"
          >
            <Space style={{ cursor: 'pointer' }}>
              <Avatar icon={<UserOutlined />} />
              <span>管理員</span>
            </Space>
          </Dropdown>
        </Header>
        <Content style={{ margin: '24px 16px', padding: 24, background: '#fff', minHeight: 280 }}>
          <Outlet />
        </Content>
      </Layout>
    </Layout>
  );
};
```

## 8. 主題與樣式系統

### 8.1 主題配置
```typescript
// config/theme.ts
import { ThemeConfig } from 'antd/es/config-provider/context';

export const theme: ThemeConfig = {
  token: {
    colorPrimary: '#1890ff',
    colorSuccess: '#52c41a',
    colorWarning: '#faad14',
    colorError: '#f5222d',
    colorInfo: '#1890ff',
    colorTextBase: '#262626',
    colorBgBase: '#ffffff',
    fontFamily: `-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji'`,
    fontSize: 14,
    borderRadius: 6,
  },
  components: {
    Button: {
      borderRadius: 6,
    },
    Card: {
      borderRadius: 8,
    },
    Table: {
      borderRadius: 8,
    },
  },
};

// styles/global.css
:root {
  --primary-color: #1890ff;
  --success-color: #52c41a;
  --warning-color: #faad14;
  --error-color: #f5222d;
  --text-color: #262626;
  --text-color-secondary: #8c8c8c;
  --border-color: #d9d9d9;
  --background-color: #f5f5f5;
  --border-radius: 6px;
  --box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.text-green {
  color: var(--success-color);
}

.text-red {
  color: var(--error-color);
}

.text-orange {
  color: var(--warning-color);
}

.text-primary {
  color: var(--primary-color);
}

.proxy-card-content {
  padding: 16px 0;
}

.proxy-info {
  margin-bottom: 16px;
}

.proxy-metrics {
  margin-bottom: 16px;
  padding: 12px;
  background: #fafafa;
  border-radius: var(--border-radius);
}

.metric-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

.metric-item:last-child {
  margin-bottom: 0;
}

.proxy-meta {
  font-size: 12px;
  color: var(--text-color-secondary);
}

.proxy-list-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
  flex-wrap: wrap;
  gap: 16px;
}

.proxy-cards {
  margin-top: 16px;
}

.dashboard-statistic {
  text-align: center;
}

.chart-container {
  width: 100%;
  height: 400px;
}

/* 響應式設計 */
@media (max-width: 768px) {
  .proxy-list-header {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .proxy-card-content {
    padding: 12px 0;
  }
  
  .proxy-metrics {
    padding: 8px;
  }
}

@media (max-width: 480px) {
  .ant-table {
    font-size: 12px;
  }
  
  .ant-card-head-title {
    font-size: 14px;
  }
  
  .ant-statistic-title {
    font-size: 12px;
  }
  
  .ant-statistic-content {
    font-size: 20px;
  }
}
```

## 9. 性能優化策略

### 9.1 組件懶加載
```typescript
// router/LazyLoad.tsx
import React, { Suspense } from 'react';
import { Spin } from 'antd';

export const LazyLoad = (Component: React.LazyExoticComponent<any>) => {
  return (
    <Suspense
      fallback={
        <div style={{ display: 'flex', justifyContent: 'center', alignItems: 'center', height: '100vh' }}>
          <Spin size="large" />
        </div>
      }
    >
      <Component />
    </Suspense>
  );
};

// 使用懶加載的頁面組件
const Dashboard = React.lazy(() => import('@/pages/Dashboard/Dashboard'));
const ProxyList = React.lazy(() => import('@/pages/Proxies/ProxyList'));
const Analytics = React.lazy(() => import('@/pages/Analytics/Analytics'));
```

### 9.2 虛擬滾動優化
```typescript
// components/VirtualTable/VirtualTable.tsx
import React, { useRef, useEffect } from 'react';
import { VariableSizeGrid as Grid } from 'react-window';
import { Table } from 'antd';

interface VirtualTableProps {
  columns: any[];
  dataSource: any[];
  height: number;
  rowHeight: number;
}

export const VirtualTable: React.FC<VirtualTableProps> = ({
  columns,
  dataSource,
  height,
  rowHeight,
}) => {
  const gridRef = useRef<Grid>(null);
  const containerRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    if (gridRef.current) {
      gridRef.current.resetAfterIndices({
        columnIndex: 0,
        rowIndex: 0,
        shouldForceUpdate: true,
      });
    }
  }, [columns, dataSource]);

  const Cell = ({ columnIndex, rowIndex, style }: any) => {
    const column = columns[columnIndex];
    const record = dataSource[rowIndex];
    
    if (!column || !record) return null;

    const content = column.render
      ? column.render(record[column.dataIndex], record, rowIndex)
      : record[column.dataIndex];

    return (
      <div
        style={{
          ...style,
          display: 'flex',
          alignItems: 'center',
          padding: '8px 16px',
          borderBottom: '1px solid #f0f0f0',
          background: rowIndex % 2 === 0 ? '#fafafa' : '#fff',
        }}
      >
        {content}
      </div>
    );
  };

  return (
    <div ref={containerRef} style={{ width: '100%', height }}>
      <Grid
        ref={gridRef}
        columnCount={columns.length}
        columnWidth={(index) => {
          const column = columns[index];
          return column.width || 150;
        }}
        height={height}
        rowCount={dataSource.length}
        rowHeight={() => rowHeight}
        width={containerRef.current?.clientWidth || 800}
      >
        {Cell}
      </Grid>
    </div>
  );
};
```

## 10. 測試策略

### 10.1 單元測試
```typescript
// __tests__/components/ProxyCard.test.tsx
import React from 'react';
import { render, screen, fireEvent } from '@testing-library/react';
import { ProxyCard } from '@/components/ProxyCard/ProxyCard';
import { Proxy } from '@/types/proxy.types';

const mockProxy: Proxy = {
  id: '1',
  ip: '192.168.1.1',
  port: 8080,
  protocol: 'http',
  country: 'US',
  anonymity: 'elite',
  status: 'active',
  responseTime: 500,
  successRate: 0.95,
  lastChecked: '2024-01-01T00:00:00Z',
  source: 'test',
  qualityScore: 0.9,
};

describe('ProxyCard', () => {
  it('renders proxy information correctly', () => {
    const mockHandlers = {
      onCheck: jest.fn(),
      onDelete: jest.fn(),
      onEdit: jest.fn(),
    };

    render(<ProxyCard proxy={mockProxy} {...mockHandlers} />);

    expect(screen.getByText('192.168.1.1:8080')).toBeInTheDocument();
    expect(screen.getByText('HTTP')).toBeInTheDocument();
    expect(screen.getByText('US')).toBeInTheDocument();
    expect(screen.getByText('elite')).toBeInTheDocument();
  });

  it('calls onCheck when check button is clicked', () => {
    const mockHandlers = {
      onCheck: jest.fn(),
      onDelete: jest.fn(),
      onEdit: jest.fn(),
    };

    render(<ProxyCard proxy={mockProxy} {...mockHandlers} />);

    const checkButton = screen.getByText('檢查');
    fireEvent.click(checkButton);

    expect(mockHandlers.onCheck).toHaveBeenCalledWith('1');
  });

  it('displays correct status indicator', () => {
    const mockHandlers = {
      onCheck: jest.fn(),
      onDelete: jest.fn(),
      onEdit: jest.fn(),
    };

    render(<ProxyCard proxy={mockProxy} {...mockHandlers} />);

    const statusIndicator = screen.getByText('在線');
    expect(statusIndicator).toBeInTheDocument();
  });
});
```

### 10.2 集成測試
```typescript
// __tests__/integration/proxyList.test.tsx
import React from 'react';
import { render, screen, waitFor } from '@testing-library/react';
import { Provider } from 'react-redux';
import { configureStore } from '@reduxjs/toolkit';
import ProxyList from '@/pages/Proxies/ProxyList';
import { proxyApi } from '@/store/services/proxyApi';

const createMockStore = () => {
  return configureStore({
    reducer: {
      [proxyApi.reducerPath]: proxyApi.reducer,
    },
    middleware: (getDefaultMiddleware) =>
      getDefaultMiddleware().concat(proxyApi.middleware),
  });
};

describe('ProxyList Integration', () => {
  it('loads and displays proxies', async () => {
    const store = createMockStore();

    render(
      <Provider store={store}>
        <ProxyList />
      </Provider>
    );

    await waitFor(() => {
      expect(screen.getByText('搜索IP地址')).toBeInTheDocument();
    });

    // 測試加載狀態
    expect(screen.getByText('刷新')).toBeInTheDocument();
  });
});
```

這個前端架構規格書提供了完整的現代化前端解決方案，包括組件化設計、狀態管理、實時通信、數據可視化、響應式設計和完整的測試策略。架構支持高可維護性、優秀的用戶體驗和強大的擴展能力。